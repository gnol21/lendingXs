$(document).ready((function(){let t=0;function e(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function n(t){t?($("#loading-spinner").show(),$("button").prop("disabled",!0)):($("#loading-spinner").hide(),$("button").prop("disabled",!1))}function a(){n(!0),$.ajax({url:"https://iptv.givethanksgrocers.com/lending/loan.php",method:"GET",success:function(a){let o=$("#table-body");o.empty(),t=0;let r=function(){let t=new Date,e=("0"+t.getDate()).slice(-2),n=("0"+(t.getMonth()+1)).slice(-2);return t.getFullYear()+"-"+n+"-"+e}();a.forEach((function(n){t++,o.append(`<tr data-id="${n.LoanID}">\n                            <td>${t}</td>\n                            <td class="text-capitalize">${n.BorrowerName}</td>\n                            <td>₱${e(n.LoanAmount)}</td>\n                            <td>${function(t,e){var n=t,a=parseInt(e)+1;if(n){var o=new Date(n);return o.setMonth(o.getMonth()+a),o.toISOString().split("T")[0]}}(n.LoanDate,n.paid)}</td>\n                            <td>₱${e(n.MonthlyPayment)}</td>\n                            <td>${n.paid}/${n.TermMonths}</td>\n                            <td>${n.Status}</td>\n                            <td class="text-center">\n                                <div class="d-flex justify-content-between align-items-center">\n                                    <input type="date" class="form-control form-control-sm repayment-date" value="${r}" style="width: 60%;" required>\n                                    <button class="btn btn-primary btn-sm repay-btn" data-id="${n.LoanID}" style="width: 35%; margin-left: 5px;">Mark as Paid</button>\n                                </div>\n                            </td>\n                        </tr>`)})),n(!1)},error:function(){alert("Failed to fetch loans"),n(!1)}})}$(document).on("click",".repay-btn",(function(){let t=$(this).data("id"),e=$(this).closest("tr"),o=e.find("td:eq(4)").text().replace(/[₱,]/g,""),r=e.find(".repayment-date").val();r?(n(!0),$.ajax({url:"https://iptv.givethanksgrocers.com/lending/repayment.php",method:"POST",contentType:"application/json",data:JSON.stringify({LoanID:t,AmountPaid:o,RepaymentDate:r}),success:function(t){alert(t.message||"Repayment successfully recorded."),a()},error:function(t){alert(t.responseJSON.error||"Failed to process repayment.")},complete:function(){n(!1)}})):alert("Please enter the repayment date.")})),a()}));