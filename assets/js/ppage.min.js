$(document).ready((function(){let t=0;function e(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function n(t){t?($("#loading-spinner").show(),$("button").prop("disabled",!0)):($("#loading-spinner").hide(),$("button").prop("disabled",!1))}function a(){n(!0),$.ajax({url:"https://iptv.givethanksgrocers.com/lending/loan.php",method:"GET",success:function(a){let r=$("#table-body"),o=function(){let t=new Date,e=("0"+t.getDate()).slice(-2),n=("0"+(t.getMonth()+1)).slice(-2);return t.getFullYear()+"-"+n+"-"+e}();r.empty(),t=0,a.forEach((function(n){t++,r.append(`<tr data-id="${n.LoanID}">\n                            <td>${t}</td>\n                            <td class="text-capitalize" >${n.BorrowerName}</td>\n                            <td>₱${e(n.MonthlyPayment*(n.TermMonths-n.paid))}</td>\n                            <td>${function(t,e){var n=t,a=parseInt(e)+1;if(n){var r=new Date(n);return r.setMonth(r.getMonth()+a),function(t){let e=t.split("-");return e[2]+"-"+e[1]+"-"+e[0]}(r.toISOString().split("T")[0])}}(n.LoanDate,n.paid)}</td>\n                            <td>₱${e(n.MonthlyPayment)}</td>\n                            <td>${n.paid}/${n.TermMonths}</td>\n                            <td>${n.Status}</td>\n                            <td class="text-center">\n                                <div class="d-flex justify-content-between align-items-center">\n                                    <input type="date" class="form-control form-control-sm repayment-date" value="${o}" style="width: 60%;" required>\n                                    <button class="btn btn-primary btn-sm repay-btn" data-id="${n.LoanID}" data-bname="${n.BorrowerName}" style="width: 35%; margin-left: 5px;">Paid</button>\n                                </div>\n                            </td>\n                        </tr>`)})),n(!1)},error:function(){alert("Failed to fetch loans"),n(!1)}})}$(document).on("click",".repay-btn",(function(){let t=$(this).data("bname"),e=$(this).data("id"),r=$(this).closest("tr"),o=r.find("td:eq(4)").text().replace(/[₱,]/g,""),i=r.find(".repayment-date").val();i?(n(!0),$.ajax({url:"https://iptv.givethanksgrocers.com/lending/payment.php",method:"POST",contentType:"application/json",data:JSON.stringify({BorrowerName:t,LoanID:e,AmountPaid:o,RepaymentDate:i}),success:function(t){alert(t.message||"Repayment successfully recorded."),a()},error:function(t){alert(t.responseJSON.error||"Failed to process repayment.")},complete:function(){n(!1)}})):alert("Please enter the repayment date.")})),a()}));